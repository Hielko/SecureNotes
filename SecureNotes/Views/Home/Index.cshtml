@model TextViewModel

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Summernote</title>
</head>

<body>
    <div id="alert" class="alert alert-warning" role="alert">
        Ready
    </div>


    <div class="wrapper">

        <!-- Sidebar Holder -->
        <nav id="sidebar" class="active">
            <div class="sidebar-header">
                <h3>Notes</h3>
            </div>

            <button type="button" id="add" onclick=AddClicked() class="btn btn-info navbar-btn">
                <i class="glyphicon glyphicon-plus"></i>
                @* <span>+</span> *@
            </button>

            <ul class="list-unstyled components">
                @{
                    foreach (var itm in Model.FileNames)
                    {
                        <li><a href="?Filename=@itm" >@itm</a></li>
                    }
                }
            </ul>
        </nav>


        <div id="content">

            <button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn">
                <i class="glyphicon glyphicon-align-left"></i>
                <span>Toggle Sidebar</span>
            </button>
            <div id="summernote"></div>

        </div>

    </div>
    

    <script>
        $(document).ready(function() {
        //    // $("#sidebar").toggleClass("active");

        //           $("#sidebarCollapse").on("click", function() {
        //   $("#sidebar").toggleClass("active");
        //   $(this).toggleClass("active");
        // });


            var alert = $('#alert');
            $('#summernote').summernote();

            var to = 0;
            var data;
            var text = '@Model.Text';
            if (text)
                $('#summernote').summernote('editor.pasteHTML'  ,htmlDecode(text));

            $('#summernote').on('summernote.change', function(we, contents, $editable) {

               alert.html("Typeing");
               data =  JSON.stringify({ '@nameof(Model.Filename)': '@Model.Filename', '@nameof(Model.Text)': contents });
               clearTimeout(to);

                to = setTimeout(function() {

                    fetch("Home/Save",{
                        method: "POST",
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: data
                    })
                    .then((response) => response.json())
                    .then((json) => {
                        console.log("response: "+json);
                        alert.html("response: "+json);
                    })
                    .catch((error) => {
                        console.log("Error: "+error);
                        alert.html("Error: "+error);
                    });

                }, 1500);


             });
         });

        function htmlDecode(input) {
           var doc = new DOMParser().parseFromString(input, "text/html");
           return doc.documentElement.textContent;
        }

                function AddClicked(el) {

            console.log("el"+el)
        }
        function fileClicked(el) {

            console.log("el"+el)
        }

    </script>
</body>
</html>
